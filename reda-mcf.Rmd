---
output: latex_fragment
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(comment = "")
options(width = 60, digits = 2)
library(reda)
suppressPackageStartupMessages(library(ggplot2))
data(readmission, package = "frailtypack")
df0 <- subset(readmission, !(id %in% c(60, 109, 280)))
```

The mean cumulative function (MCF) is often the focus in a nonparametric analysis of recurrent data.
Let $M_i(t)=\mathbb{E}\{N_i(t)\}$ denote the MCF of
$N_i(t)$.  The Nelson-Aalen estimator \citep{nelson2003siam} are widely utilized
in exploring the trend of recurrent event data.
$$\hat{M}(t) = \int_0^t \frac{dN(s)}{\delta(s)},$$
where $dN(s)=\sum_{i=1}^k dN_i(s)$, $\delta(s) = 
\sum_{i=1}^k \delta_i(s)$, $dN_i(s)$ and $\delta_i(s)$ is, respectively, the
jump size and at-risk indicator of process $i$ at time $s$.
The MCF can be visualized by plotting the `Recur` object with argument
`MCF = TRUE` when the \pkg{reReg} package is active.
The \pkg{reReg} package also offers the `plotMCF()` function for plotting MCF estimates
to be stratified by discrete variables. 
Alternatively, the `mcf()` function from the \pkg{reda} package provides a more
sophisticated approach to plot MCFs.
Some of the unique features the `mcf()` has include the different
variance estimations, confidence interval constructions, and predictions.
The following example uses the `mcf()` function to visualize MCF estimates
stratified by whether the patients receive chemotherapy.
<!-- We may use the `mcf()` function and the associated `plot()` method provided by
the \pkg{reda} package to visualize MCF estimates stratified by whether the
patients receive chemotherapy as follows.
Terminal events are ignored here for ease of illustration. -->
The `plot()` method, as well as the `plotEvents()` function,
return a `ggplot2` object \citep{hadley2016ggplot2} so that
users may further customize the plot easily.

```{r plot-sampleMcf-code, eval = FALSE}
re_mcf <- mcf(fn, data = df0)
plot(re_mcf, conf.int = TRUE, lty = 1:2) +
    ggplot2::theme(legend.position = "bottom")
```

```{r plot-sampleMcf, echo = FALSE, fig.width = 3.5, fig.height = 3, fig.show = 'hide'}
re_mcf <- mcf(Recur(t.stop, id, event) ~ chemo, data = df0)
plot(re_mcf, conf.int = TRUE, lty = 1:2) +
    theme(legend.position = "bottom",
          axis.title = element_text(size = 8),
          legend.title = element_text(size = 8),
          legend.text = element_text(size = 8),
          legend.box.margin = margin(-12, -10, -10, -10))
```
\begin{figure}[H]
\includegraphics[scale = 1]{reda-mcf_files/figure-latex/plot-sampleMcf-1}
\end{figure}
	
Furthermore, the MCF difference between two groups can be tested 
with the two-sample pseudo-score tests  
\citep{cook1996biometrics} via `mcfDiff.test()` as follows:
```{r mcfdiff, echo = TRUE}
mcfDiff.test(re_mcf)
```
Both the constant weighted and the linear weighted tests indicate
the MCF estimates are statistically different at a significance level of 0.05.	